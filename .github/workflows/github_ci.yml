name: Build and Deploy Expo Web App

on:
push:
branches:
- main
paths:
- 'app/'
- 'components/'
- 'utils/'
- 'styles/'
- 'store/**'
- 'package.json'
- 'yarn.lock'
pull_request:
branches:
- main

jobs:
build_and_deploy:
runs-on: ubuntu-latest
env:
EXPO_PUBLIC_SUPABASE_URL: ${{ secrets.EXPO_PUBLIC_SUPABASE_URL }}
EXPO_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.EXPO_PUBLIC_SUPABASE_ANON_KEY }}

steps:
  - name: Checkout repository
    uses: actions/checkout@v4

  - name: Set up Node.js
    uses: actions/setup-node@v4
    with:
      node-version: 20.x

  - name: Install dependencies
    run: yarn install --frozen-lockfile

  - name: Build Expo web app
    run: npx expo export --platform web --output-dir dist

  - name: Create .nojekyll file
    run: touch dist/.nojekyll

  - name: Deploy to GitHub Pages
    uses: JamesIves/github-pages-deploy-action@v4
    with:
      branch: gh-pages
      folder: dist
      clean: true
      clean_exclude: |
        .nojekyll
